<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMPLE_JSON - Use Case: Validation</title>
    <style>
        body {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        h3 {
            color: #34495e;
            margin-top: 20px;
        }
        
        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .tip {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        nav {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 30px;
        }
        
        nav a {
            color: #3498db;
            text-decoration: none;
            margin-right: 15px;
        }
        
        nav a:hover {
            text-decoration: underline;
        }
        
        .back-link {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <nav>
        <a href="../index.html">Home</a>
        <a href="../quick-start.html">Quick Start</a>
        <a href="index.html">Use Cases</a>
    </nav>

    <h1 id="use-case-validation">Use Case 6: JSON Validation</h1>
    
    <h2 id="overview">Overview</h2>
    <p>Validate JSON syntax before processing to prevent errors and provide clear feedback to users. Essential for handling untrusted input from external sources, user uploads, or API responses.</p>
    
    <p><strong>When to use this:</strong></p>
    <ul>
        <li>Processing user-supplied JSON (file uploads, form input)</li>
        <li>Validating external API responses</li>
        <li>Accepting configuration files that might be hand-edited</li>
        <li>Need to provide clear error messages before processing</li>
    </ul>
    
    <h2 id="the-problem">The Problem</h2>
    <p>Processing invalid JSON leads to parsing failures and unclear error messages. Without validation, your application might crash or behave unexpectedly when given malformed JSON:</p>
    
    <pre><code class="eiffel">-- BAD: No validation, might fail silently
obj := json.parse (user_input)
if obj = Void then
    -- What went wrong? User doesn't know!
    print ("Something failed")
end</code></pre>
    
    <p>Problems with this approach:</p>
    <ul>
        <li>No clear error message for the user</li>
        <li>Cannot distinguish between invalid JSON vs empty result</li>
        <li>Wastes resources attempting to parse known-bad input</li>
        <li>Poor user experience</li>
    </ul>
    
    <h2 id="solution-simple">Solution 1: Quick Validation Check</h2>
    <p>Use <code>is_valid</code> for fast yes/no validation:</p>
    
    <pre><code class="eiffel">local
    json: JSON
    user_input: STRING
do
    create json
    user_input := get_user_input
    
    -- Quick validation check
    if json.is_valid (user_input) then
        -- Safe to parse
        obj := json.parse (user_input)
        process_json (obj)
    else
        -- Show user-friendly error
        show_error ("Invalid JSON format. Please check your input.")
    end
end</code></pre>
    
    <div class="tip">
        <strong>ðŸ’¡ Tip:</strong> <code>is_valid</code> is fast and lightweight - use it as a first line of defense before parsing.
    </div>
    
    <h2 id="solution-detailed">Solution 2: Detailed Validation with Error Messages</h2>
    <p>Use <code>validate</code> to get detailed error information:</p>
    
    <pre><code class="eiffel">local
    json: JSON
    user_input: STRING
    result: TUPLE[valid: BOOLEAN; error: detachable STRING]
do
    create json
    user_input := get_user_input
    
    -- Validate with detailed error message
    result := json.validate (user_input)
    
    if result.valid then
        -- JSON is valid, proceed
        obj := json.parse (user_input)
        process_json (obj)
    else
        -- Show specific error to user
        if attached result.error as err then
            show_error ("JSON validation failed: " + err)
            log_error ("Validation error for user input: " + err)
        else
            show_error ("Unknown validation error")
        end
    end
end</code></pre>
    
    <h2 id="explanation">Explanation</h2>
    
    <h3>Validation Methods</h3>
    <table>
        <thead>
            <tr>
                <th>Method</th>
                <th>Return Type</th>
                <th>Use Case</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>is_valid(json_string)</code></td>
                <td><code>BOOLEAN</code></td>
                <td>Quick yes/no check, fast</td>
            </tr>
            <tr>
                <td><code>validate(json_string)</code></td>
                <td><code>TUPLE[valid: BOOLEAN; error: detachable STRING]</code></td>
                <td>Detailed validation with error message</td>
            </tr>
        </tbody>
    </table>
    
    <h3>What Gets Validated</h3>
    <p>Both validation methods check for:</p>
    <ul>
        <li>Proper JSON structure (matching braces, brackets)</li>
        <li>Correct quote usage for strings</li>
        <li>Valid key-value pairs in objects</li>
        <li>Proper comma placement</li>
        <li>Valid data types (strings, numbers, booleans, null)</li>
        <li>No trailing commas</li>
    </ul>
    
    <h2 id="complete-example">Complete Example: File Upload Validator</h2>
    
    <pre><code class="eiffel">class
    CONFIG_FILE_VALIDATOR

create
    make

feature {NONE} -- Initialization

    make
            -- Validate and load configuration file
        local
            file_content: STRING
        do
            file_content := load_file ("config.json")
            
            if validate_and_load (file_content) then
                print ("Configuration loaded successfully%N")
            else
                print ("Failed to load configuration%N")
            end
        end

feature -- Validation

    validate_and_load (a_content: STRING): BOOLEAN
            -- Validate JSON content and load if valid
        local
            json: JSON
            validation_result: TUPLE[valid: BOOLEAN; error: detachable STRING]
            config: detachable SIMPLE_JSON_OBJECT
        do
            create json
            
            -- Step 1: Validate the JSON
            validation_result := json.validate (a_content)
            
            if validation_result.valid then
                -- Step 2: Parse (we know it's valid)
                config := json.parse (a_content)
                
                if attached config as cfg then
                    -- Step 3: Validate structure (application-specific)
                    if validate_config_structure (cfg) then
                        load_configuration (cfg)
                        Result := True
                    else
                        log_error ("Configuration file has invalid structure")
                        Result := False
                    end
                else
                    -- Should never happen since validation passed
                    log_error ("Unexpected parsing failure")
                    Result := False
                end
            else
                -- JSON syntax is invalid
                if attached validation_result.error as err then
                    log_error ("JSON syntax error: " + err)
                    notify_user ("Configuration file contains invalid JSON: " + err)
                end
                Result := False
            end
        end

    validate_config_structure (a_config: SIMPLE_JSON_OBJECT): BOOLEAN
            -- Validate that config has required fields
        do
            Result := True
            
            -- Check for required fields
            if not a_config.has_key ("app_name") then
                log_error ("Missing required field: app_name")
                Result := False
            end
            
            if not a_config.has_key ("version") then
                log_error ("Missing required field: version")
                Result := False
            end
            
            -- Validate field types by attempting to extract
            if a_config.has_key ("port") then
                if a_config.integer ("port") <= 0 then
                    log_error ("Invalid port number")
                    Result := False
                end
            end
        end

feature {NONE} -- Implementation

    load_file (a_path: STRING): STRING
            -- Load file content (simplified)
        do
            Result := "{%"app_name%": %"MyApp%", %"version%": %"1.0%", %"port%": 8080}"
        end

    load_configuration (a_config: SIMPLE_JSON_OBJECT)
            -- Load validated configuration
        do
            app_name := a_config.string ("app_name")
            version := a_config.string ("version")
            port := a_config.integer ("port")
            
            print ("Loaded: " + app_name.out + " v" + version.out + "%N")
        end

    log_error (a_message: STRING)
            -- Log error message
        do
            print ("[ERROR] " + a_message + "%N")
        end

    notify_user (a_message: STRING)
            -- Notify user of error
        do
            print ("[USER] " + a_message + "%N")
        end

feature {NONE} -- Attributes

    app_name, version: detachable STRING
    port: INTEGER

end</code></pre>
    
    <h2 id="validation-patterns">Common Validation Patterns</h2>
    
    <h3>Pre-Parse Validation</h3>
    <pre><code class="eiffel">-- Validate before parsing (recommended for untrusted input)
if json.is_valid (external_input) then
    obj := json.parse (external_input)
    -- Process obj
else
    handle_invalid_json
end</code></pre>
    
    <h3>Parse with Error Checking</h3>
    <pre><code class="eiffel">-- Parse and check for success
obj := json.parse (input)
if obj = Void then
    -- Parse failed
    if attached json.last_error as err then
        log_error ("Parse failed: " + err)
    end
else
    -- Success
    process (obj)
end</code></pre>
    
    <h3>Validation with User Feedback</h3>
    <pre><code class="eiffel">validate_user_json (user_input: STRING): BOOLEAN
        -- Validate and provide user feedback
    local
        json: JSON
        result: TUPLE[valid: BOOLEAN; error: detachable STRING]
    do
        create json
        result := json.validate (user_input)
        
        if result.valid then
            show_success ("JSON is valid!")
            Result := True
        else
            if attached result.error as err then
                -- Provide helpful feedback
                show_error ("Invalid JSON: " + err)
                show_hint ("Check for missing quotes, commas, or brackets")
            end
            Result := False
        end
    end</code></pre>
    
    <h2 id="multi-layer">Multi-Layer Validation</h2>
    <p>For robust applications, validate at multiple levels:</p>
    
    <pre><code class="eiffel">validate_thoroughly (input: STRING): BOOLEAN
        -- Comprehensive validation
    local
        json: JSON
        obj: detachable SIMPLE_JSON_OBJECT
    do
        create json
        
        -- Layer 1: Syntax validation
        if not json.is_valid (input) then
            log_error ("Syntax validation failed")
            Result := False
        else
            -- Layer 2: Parse validation
            obj := json.parse (input)
            if obj = Void then
                log_error ("Parse failed despite valid syntax")
                Result := False
            else
                -- Layer 3: Structure validation
                if validate_required_fields (obj) then
                    -- Layer 4: Business logic validation
                    Result := validate_business_rules (obj)
                else
                    log_error ("Missing required fields")
                    Result := False
                end
            end
        end
    end</code></pre>
    
    <h2 id="common-errors">Common JSON Errors Detected</h2>
    
    <table>
        <thead>
            <tr>
                <th>Invalid JSON</th>
                <th>Problem</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>{name: "Alice"}</code></td>
                <td>Keys must be quoted</td>
            </tr>
            <tr>
                <td><code>{"name": "Alice",}</code></td>
                <td>Trailing comma not allowed</td>
            </tr>
            <tr>
                <td><code>{"name": 'Alice'}</code></td>
                <td>Must use double quotes, not single</td>
            </tr>
            <tr>
                <td><code>{"name": "Alice"</code></td>
                <td>Missing closing brace</td>
            </tr>
            <tr>
                <td><code>{name: Alice}</code></td>
                <td>String values must be quoted</td>
            </tr>
        </tbody>
    </table>
    
    <div class="warning">
        <strong>âš ï¸ Security Note:</strong> Always validate JSON from external sources (user input, APIs, files) before parsing to prevent injection attacks and resource exhaustion.
    </div>
    
    <h2 id="when-to-validate">When to Validate</h2>
    
    <table>
        <thead>
            <tr>
                <th>Source</th>
                <th>Validate?</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>User file upload</td>
                <td>âœ… Always</td>
                <td>Untrusted, might be malformed</td>
            </tr>
            <tr>
                <td>External API</td>
                <td>âœ… Always</td>
                <td>Network issues, API changes</td>
            </tr>
            <tr>
                <td>User form input</td>
                <td>âœ… Always</td>
                <td>User might make mistakes</td>
            </tr>
            <tr>
                <td>Your own code generation</td>
                <td>âš ï¸ During development</td>
                <td>Catch bugs early</td>
            </tr>
            <tr>
                <td>Hardcoded constants</td>
                <td>âŒ Optional</td>
                <td>Should be correct at compile time</td>
            </tr>
        </tbody>
    </table>
    
    <h2 id="related">Related Use Cases</h2>
    <ul>
        <li><a href="error-handling.html">Use Case 7: Error Handling</a> - Handle validation failures gracefully</li>
        <li><a href="quick-extraction.html">Use Case 1: Quick Value Extraction</a> - Extract after validation</li>
        <li><a href="building-json.html">Use Case 4: Building JSON</a> - Generated JSON is always valid</li>
    </ul>
    
    <div class="back-link">
        <a href="index.html">â† Back to Use Cases</a>
    </div>
</body>
</html>