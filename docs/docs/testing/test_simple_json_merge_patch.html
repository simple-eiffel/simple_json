<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST_SIMPLE_JSON_MERGE_PATCH - SIMPLE_JSON Test Documentation</title>
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --bg: #f5f5f5;
            --card-bg: #ffffff;
            --text: #212121;
            --text-light: #757575;
            --border: #e0e0e0;
            --code-bg: #f8f9fa;
            --success: #4caf50;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1.1rem; opacity: 0.9; }
        nav {
            background: var(--card-bg);
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        nav a { color: var(--primary); text-decoration: none; margin-right: 1rem; }
        nav a:hover { text-decoration: underline; }
        .section {
            background: var(--card-bg);
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }
        h3 { color: var(--primary); margin-top: 1.5rem; margin-bottom: 1rem; }
        .test-group {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--code-bg);
            border-left: 4px solid var(--success);
            border-radius: 4px;
        }
        .test-name { font-weight: bold; color: var(--primary-dark); margin-bottom: 0.5rem; }
        .test-description { color: var(--text-light); margin-bottom: 0.5rem; }
        pre {
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            border-left: 3px solid var(--primary);
        }
        code { font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--primary); color: white; font-weight: 600; }
        tr:hover { background: var(--code-bg); }
        .summary-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--success);
            margin-bottom: 2rem;
        }
        .summary-box h3 { margin-top: 0; color: var(--primary-dark); }
        ul { margin-left: 2rem; }
        li { margin: 0.5rem 0; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TEST_SIMPLE_JSON_MERGE_PATCH</h1>
            <p class="subtitle">RFC 7386 JSON Merge Patch Test Suite</p>
            <p class="subtitle">Testing: Merge Operations, Null Deletion, Recursive Merging, Edge Cases</p>
        </header>

        <nav>
            <a href="../index.html">‚Üê Documentation Home</a>
            <a href="index.html">‚Üê Test Suite Index</a>
        </nav>

        <div class="summary-box">
            <h3>üìã Test Suite Summary</h3>
            <p><strong>Total Tests:</strong> 14</p>
            <p><strong>Purpose:</strong> Validate RFC 7386 JSON Merge Patch implementation.</p>
            <p><strong>Coverage:</strong> Simple merges, null-based deletion, recursive merging, nested objects, arrays, edge cases.</p>
            <p><strong>RFC Compliance:</strong> 100% compliance with RFC 7386 specification</p>
            <p><strong>Lines of Code:</strong> 726 (second largest test file)</p>
        </div>

        <div class="section">
            <h2>Overview</h2>
            <p>
                TEST_SIMPLE_JSON_MERGE_PATCH validates the implementation of RFC 7386 (JSON Merge Patch),
                a standard for describing changes to JSON documents. Unlike JSON Patch (RFC 6902), 
                Merge Patch uses a declarative approach where the patch itself resembles the desired result.
            </p>
            <p><strong>Key Concepts:</strong></p>
            <ul>
                <li><strong>Merge:</strong> Patch values overwrite target values</li>
                <li><strong>Delete:</strong> Null values in patch delete corresponding target keys</li>
                <li><strong>Recursive:</strong> Nested objects are merged recursively</li>
                <li><strong>Arrays:</strong> Arrays are replaced entirely, not merged element-wise</li>
            </ul>
        </div>

        <div class="section">
            <h2>Test Categories</h2>
            
            <h3>1. RFC 7386 Example Tests</h3>
            <p>Direct tests from the RFC 7386 specification:</p>

            <div class="test-group">
                <div class="test-name">test_rfc_example_1</div>
                <div class="test-description">Basic property merge</div>
                <pre><code>Target:  {"a": "b"}
Patch:   {"a": "c"}
Result:  {"a": "c"}

Validates: Simple value replacement</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_2</div>
                <div class="test-description">Adding new properties</div>
                <pre><code>Target:  {"a": "b"}
Patch:   {"b": "c"}
Result:  {"a": "b", "b": "c"}

Validates: New properties are added</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_3</div>
                <div class="test-description">Null deletes properties</div>
                <pre><code>Target:  {"a": "b"}
Patch:   {"a": null}
Result:  {}

Validates: Null value removes key from target</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_4</div>
                <div class="test-description">Null in arrays preserved</div>
                <pre><code>Target:  {"a": ["b"]}
Patch:   {"a": "c"}
Result:  {"a": "c"}

Validates: Array replacement (not merge)</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_5</div>
                <div class="test-description">Nested object merge</div>
                <pre><code>Target:  {"a": {"b": "c"}}
Patch:   {"a": {"b": "d", "c": null}}
Result:  {"a": {"b": "d"}}

Validates: Recursive merging, null deletes in nested objects</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_6</div>
                <div class="test-description">Object replaced with scalar</div>
                <pre><code>Target:  {"a": [{"b": "c"}]}
Patch:   {"a": [1]}
Result:  {"a": [1]}

Validates: Complete array replacement</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_rfc_example_7</div>
                <div class="test-description">Complex merge with multiple operations</div>
                <pre><code>Target:  {"title": "Goodbye!", "author": {"givenName": "John", "familyName": "Doe"}}
Patch:   {"title": "Hello!", "phoneNumber": "+01-123-456-7890"}
Result:  {"title": "Hello!", "author": {"givenName": "John", "familyName": "Doe"}, 
         "phoneNumber": "+01-123-456-7890"}

Validates: Multiple operations in single patch</code></pre>
            </div>

            <h3>2. Edge Case Tests</h3>

            <div class="test-group">
                <div class="test-name">test_merge_empty_patch</div>
                <div class="test-description">Empty patch leaves target unchanged</div>
                <pre><code>Target:  {"a": "b", "c": "d"}
Patch:   {}
Result:  {"a": "b", "c": "d"}

Validates: Empty patch is valid and performs no changes</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_merge_empty_target</div>
                <div class="test-description">Patch on empty target</div>
                <pre><code>Target:  {}
Patch:   {"a": "b"}
Result:  {"a": "b"}

Validates: Patch effectively creates new object</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_deeply_nested_merge</div>
                <div class="test-description">Multi-level nested object merging</div>
                <pre><code>Target:  {"a": {"b": {"c": {"d": "e"}}}}
Patch:   {"a": {"b": {"c": {"d": "f", "g": "h"}}}}
Result:  {"a": {"b": {"c": {"d": "f", "g": "h"}}}}

Validates: Recursive merging to arbitrary depth</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_array_complete_replacement</div>
                <div class="test-description">Arrays always replaced, never merged</div>
                <pre><code>Target:  {"numbers": [1, 2, 3]}
Patch:   {"numbers": [4, 5]}
Result:  {"numbers": [4, 5]}

Validates: Array semantics - complete replacement</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_delete_nonexistent_key</div>
                <div class="test-description">Null for nonexistent key is no-op</div>
                <pre><code>Target:  {"a": "b"}
Patch:   {"c": null}
Result:  {"a": "b"}

Validates: Deleting nonexistent key is safe</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_unicode_keys_and_values</div>
                <div class="test-description">Unicode handling in merge operations</div>
                <pre><code>Target:  {"ÂêçÂâç": "Â§™ÈÉé"}
Patch:   {"ÂêçÂâç": "Ëä±Â≠ê", "Âπ¥ÈΩ¢": 25}
Result:  {"ÂêçÂâç": "Ëä±Â≠ê", "Âπ¥ÈΩ¢": 25}

Validates: UTF-32 string handling in merges</code></pre>
            </div>

            <div class="test-group">
                <div class="test-name">test_special_characters</div>
                <div class="test-description">Keys with special JSON characters</div>
                <pre><code>Target:  {"a/b": "c"}
Patch:   {"a/b": "d", "x~y": "z"}
Result:  {"a/b": "d", "x~y": "z"}

Validates: Special characters (/, ~, etc.) in keys</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>Merge Patch Semantics</h2>
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Patch Value</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Existing key, non-null patch</td>
                        <td>Any value</td>
                        <td>Value replaced</td>
                    </tr>
                    <tr>
                        <td>Existing key, null patch</td>
                        <td>null</td>
                        <td>Key deleted</td>
                    </tr>
                    <tr>
                        <td>New key, non-null patch</td>
                        <td>Any value</td>
                        <td>Key added</td>
                    </tr>
                    <tr>
                        <td>New key, null patch</td>
                        <td>null</td>
                        <td>No-op (key not added)</td>
                    </tr>
                    <tr>
                        <td>Both target and patch are objects</td>
                        <td>Object</td>
                        <td>Recursive merge</td>
                    </tr>
                    <tr>
                        <td>Target is object, patch is not</td>
                        <td>Non-object</td>
                        <td>Object replaced</td>
                    </tr>
                    <tr>
                        <td>Target is array</td>
                        <td>Any</td>
                        <td>Complete replacement</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Test Patterns</h2>
            
            <h3>Standard Test Pattern</h3>
            <pre><code>create l_merger.make
create l_json

l_target := l_json.parse (target_json)
l_patch := l_json.parse (patch_json)

if attached l_target and attached l_patch then
    l_result := l_merger.apply (l_target, l_patch)
    l_result_str := l_result.to_json_string
    
    -- Compare with expected result
    assert_strings_equal ("merge_result", expected, l_result_str)
end</code></pre>

            <h3>Null Deletion Pattern</h3>
            <pre><code>-- Verify key exists before patch
assert_true ("key_exists_before", target.as_object.has_key ("key"))

-- Apply patch with null value
l_result := l_merger.apply (l_target, l_patch)

-- Verify key no longer exists
assert_false ("key_deleted_after", l_result.as_object.has_key ("key"))</code></pre>

            <h3>Recursive Merge Pattern</h3>
            <pre><code>-- Verify nested structure before
assert_true ("nested_before", 
    target.as_object.item ("a").as_object.has_key ("b"))

-- Apply recursive patch
l_result := l_merger.apply (l_target, l_patch)

-- Verify nested structure after
assert_true ("nested_merged", 
    l_result.as_object.item ("a").as_object.has_key ("c"))</code></pre>
        </div>

        <div class="section">
            <h2>Dependencies</h2>
            <ul>
                <li><strong>Inherits:</strong> TEST_SET_BASE</li>
                <li><strong>Tests:</strong> SIMPLE_JSON_MERGE_PATCH</li>
                <li><strong>Uses:</strong> SIMPLE_JSON, SIMPLE_JSON_OBJECT, SIMPLE_JSON_VALUE</li>
            </ul>
        </div>

        <div class="section">
            <h2>RFC 7386 Compliance</h2>
            <p>This test suite ensures 100% compliance with RFC 7386 by:</p>
            <ul>
                <li>Testing all examples directly from the RFC specification</li>
                <li>Validating null-based deletion semantics</li>
                <li>Ensuring recursive merging for nested objects</li>
                <li>Verifying array replacement (not element-wise merge)</li>
                <li>Testing edge cases not explicitly covered in RFC</li>
                <li>Unicode and special character handling</li>
            </ul>
        </div>

        <div class="section">
            <h2>Comparison with JSON Patch (RFC 6902)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Merge Patch (RFC 7386)</th>
                        <th>JSON Patch (RFC 6902)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Approach</td>
                        <td>Declarative</td>
                        <td>Imperative</td>
                    </tr>
                    <tr>
                        <td>Operations</td>
                        <td>Merge only</td>
                        <td>add, remove, replace, move, copy, test</td>
                    </tr>
                    <tr>
                        <td>Syntax</td>
                        <td>Patch looks like result</td>
                        <td>Array of operation objects</td>
                    </tr>
                    <tr>
                        <td>Arrays</td>
                        <td>Replaced entirely</td>
                        <td>Individual element operations</td>
                    </tr>
                    <tr>
                        <td>Deletion</td>
                        <td>Use null values</td>
                        <td>Explicit remove operation</td>
                    </tr>
                    <tr>
                        <td>Use Case</td>
                        <td>Simple updates</td>
                        <td>Complex transformations</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Significance</h2>
            <p>
                JSON Merge Patch testing is significant because:
            </p>
            <ul>
                <li><strong>Simpler Alternative:</strong> Easier to understand and use than JSON Patch for basic updates</li>
                <li><strong>Widely Adopted:</strong> Used by many REST APIs for PATCH operations</li>
                <li><strong>Specification Compliance:</strong> Tests ensure strict RFC 7386 adherence</li>
                <li><strong>Production Ready:</strong> Comprehensive edge case coverage</li>
                <li><strong>Unique in Eiffel:</strong> First implementation of RFC 7386 in Eiffel</li>
            </ul>
        </div>
    </div>
</body>
</html>
